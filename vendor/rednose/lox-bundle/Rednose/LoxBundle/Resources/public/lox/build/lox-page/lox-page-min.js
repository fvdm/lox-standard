YUI.add("lox-page",function(e,t){var n="Change password",r="Sign out",i=10,s=e.Base.create("page",e.View,[],{initializer:function(){var t=e.one("#user-dropdown");this.navBar=new e.Rednose.Navbar,this.navBar.createDropdown(t,[{title:n,url:YUI.Env.routing.change_password},{title:"-"},{title:r,url:YUI.Env.routing.logout}]),e.one(".rednose-lox-sidenav")&&e.one(".rednose-lox-sidenav").plug(e.Plugin.Affix,{offset:{top:70}}),this._initBadge(),this._updateNotifications(),this._bindMarkRead()},destructor:function(){this.navBar.destroy(),this.navBar=null},render:function(){return this.navBar.render(),this},_initBadge:function(){var t,n;n=new e.DataSource.IO({source:YUI.Env.routing.notifications_unread}),t={callback:{success:function(t){var n=parseInt(t.response.results[0].responseText,10);e.one("#badge-notifications").setContent(n>0?n:null)}}},n.setInterval(i*6e3,t)},_updateNotifications:function(){var t=this;e.io(YUI.Env.routing.notifications,{method:"GET",on:{success:function(n,r){var i=e.one("#notifications-dropdown"),s=e.JSON.parse(r.responseText),o=[];i.one(".dropdown-menu").empty(),e.Array.each(s,function(t){o.push({node:e.Node.create(t.html)})}),t.navBar.createDropdown(i,o)}}})},_bindMarkRead:function(){var t=e.one("#notifications-dropdown"),n=this;t.on("click",function(){e.io(YUI.Env.routing.notifications_mark_read,{method:"POST",on:{success:function(){n._updateNotifications(),e.one("#badge-notifications").setContent(null)}}})})}});e.namespace("Lox").Page=s},"@VERSION@",{requires:["node","base","datasource-io","datasource-polling","gallery-affix","io","json","rednose-navbar","view"]});
