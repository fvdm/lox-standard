YUI.add("lox-app-base",function(e,t){var n="Error",r="Copied",i="Item successfully copied.",s="Moved",o="Item successfully moved.",u="Unshare",a="Unshare folder '{item}'?",f="The folder will no longer be shared and will be visible to only you. Are you sure you want to stop sharing?",l="Share removed",c="The folder is no longer shared",h=e.Base.create("app",e.Rednose.App,[],{views:{itemView:{type:"Lox.App.FileBrowserView"},uploadView:{type:"Lox.App.FileUploadView",parent:"itemView",width:"640px",height:"250px",modal:!0},detailView:{type:"Lox.App.FileDetailView",parent:"itemView",width:"500px",height:"300px",modal:!0},moveCopyView:{type:"Lox.App.FileMoveCopyView",parent:"itemView",width:"500px",height:"400px",modal:!0},folderShareView:{type:"Lox.App.FolderShareView",parent:"itemView",width:"640px",height:"400px",modal:!0}},initializer:function(t){t||(t={}),new e.Rednose.Tooltip({selector:"*[rel=tooltip]"}),this.on({"*:buttonClose":this.popModalView,"*:buttonCancel":this.popModalView,"*:reload":this._handleReload,"*:uploadcomplete":this._handleReload,"*:navigateItem":this._navigateToItemView,"*:showItemDetail":this._showDetailItem,"*:upload":this._handleUpload,"*:leave":this._handleLeaveShare,"*:share":this._handleShareFolder,"*:move":this._handleMoveCopy,"*:copy":this._handleMoveCopy,"fileMoveCopyView:buttonConfirm":this._handleMoveCopyConfirm,"folderShareView:buttonConfirm":this._handleShareConfirm,"folderShareView:buttonRemove":this._handleShareRemove})},render:function(){return this.hasRoute(this.getPath())?this.dispatch():this.showView("itemView",{modelList:this.get("item")}),this},_handleUpload:function(){var e=this.get("item").get("path");this.showView("uploadView",{path:e})},_navigateToItemView:function(e){var t=e.path;this.navigate(t)},_showDetailItem:function(e){var t=e.model;this.showView("detailView",{model:t})},_handleShareFolder:function(t){var n=t.data,r=this;n.load(function(){if(n.get("isShared")){var t=new e.Lox.ShareModel;t.load({path:n.get("path")},function(){r.showView("folderShareView",{model:t})})}else r.showView("folderShareView",{model:new e.Lox.ShareModel({item:n})})})},_handleLeaveShare:function(t){var n=t.data;e.io(YUI.Env.routing.shares_base+n.get("path")+"/leave",{method:"POST",on:{success:function(){n.destroy()}}})},_handleMoveCopy:function(t){var n=t.data,r=t.type==="contextMenu:move"||t.type==="navbar:move"?"move":"copy",i=new e.Lox.App.FolderTree,s=this;i.load(function(){s.showView("moveCopyView",{type:r,model:n,modelTree:i})})},_handleMoveCopyConfirm:function(t){var u=t.data.type,a=t.data.model,f=t.data.path==="/"?"":t.data.path,l=u==="move"?"operations_move":"operations_copy",c=this;this.popModalView(),e.io(YUI.Env.routing[l],{method:"POST",data:{from_path:a.get("path"),to_path:f+"/"+a.get("title")},on:{success:function(){c.fire("reload"),e.Rednose.Notifier.notify({title:u==="move"?s:r,text:u==="move"?o:i,type:"success"})},failure:function(t,r){var i=r.responseText&&e.JSON.parse(r.responseText);e.Rednose.Notifier.notify({title:n,text:i.error,type:"error"})}}})},_handleShareConfirm:function(e){var t=e.data.model,n=this;t.save(function(){n.popModalView(),n.fire("reload")})},_handleShareRemove:function(t){var n=t.data.model,r=this;this.popModalView(),e.Rednose.Dialog.confirm({title:e.Lang.sub(a,{item:n.get("item").get("title")}),text:f,confirm:u,type:"warning"},function(){n.destroy({remove:!0},function(){e.Rednose.Notifier.notify({title:l,text:c,type:"success"}),r.fire("reload")})})},_handleReload:function(){var e=this;this.get("item").load(function(){e.get("children").reset(e.get("item").get("children"))})},_handleItem:function(t,n,r){var i=t.path,s=this.get("item"),o=this;i===s.get("path")&&!s.isNew()?(t.item=s,r()):(s=new e.Lox.ItemModel({path:i}),s.load(function(){o.set("item",s),t.item=s,r()}))},_handleChildren:function(e,t,n){var r=e.item,i=this.get("children");e.children=i,r===i.get("item")?n():(i.set("item",r).reset(r.get("children")),n())},_showItemPage:function(e){this.showView("itemView",{model:e.item,modelList:e.children})}},{ATTRS:{item:{value:new e.Lox.ItemModel},children:{value:new e.ModelList({model:e.Lox.ItemModel})},root:{value:YUI.Env.routing.home},routes:{value:[{path:"/*",callbacks:["_handleItem","_handleChildren","_showItemPage"]}]}}});e.namespace("Lox").App=h},"@VERSION@",{requires:["lox-app-item-model","rednose-app","rednose-tooltip"]});
